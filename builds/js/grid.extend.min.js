/**
* jQuery.bsgrid v1.32 by @Baishui2004
* Copyright 2014 Apache v2 License
* https://github.com/baishui2004/jquery.bsgrid
*/
(function(a){a.fn.bsgrid.defaults.extend.settings={supportGridEdit:false,supportGridEditTriggerEvent:"rowClick",supportColumnMove:false,searchConditionsContainerId:"",fixedGridHeader:false,fixedGridHeight:"320px"};a.fn.bsgrid.defaults.colsProperties.checkAttr="w_check";a.fn.bsgrid.defaults.colsProperties.editAttr="w_edit";a.fn.bsgrid.defaults.colsProperties.aggAttr="w_agg";a.fn.bsgrid.extendInitGrid={};a.fn.bsgrid.extendBeforeRenderGrid={};a.fn.bsgrid.extendRenderPerRow={};a.fn.bsgrid.extendRenderPerColumn={};a.fn.bsgrid.extendAfterRenderGrid={};a.fn.bsgrid.extendOtherMethods={};a.fn.bsgrid.extendOtherMethods.fixedHeader=function(b,c){if(a.trim(a("#"+c.gridId+"_fixedDiv").data("fixedGridLock"))=="lock"){return}a("#"+c.gridId+"_fixedDiv").data("fixedGridLock","lock");var e=a("#"+c.gridId+" thead tr").length;if(!b){e=e/2;a("#"+c.gridId+" thead tr:lt("+e+")").remove()}var d=f(c.settings.extend.settings.fixedGridHeight);if(d<a("#"+c.gridId).height()){a("#"+c.gridId+"_fixedDiv").height(d);a("#"+c.gridId).width(a("#"+c.gridId+"_fixedDiv").width()-18);a("#"+c.gridId+"_fixedDiv").animate({scrollTop:"0px"},0)}else{a("#"+c.gridId+"_fixedDiv").height(a("#"+c.gridId).height());a("#"+c.gridId).width(a("#"+c.gridId+"_fixedDiv").width()-1)}a("#"+c.gridId+" thead tr:lt("+e+")").clone(true).prependTo("#"+c.gridId+" thead");a("#"+c.gridId+" thead tr:lt("+e+")").css({"z-index":10,position:"fixed"}).width(a("#"+c.gridId+" thead tr:last").width());a("#"+c.gridId+" thead tr:lt("+e+")").each(function(h){var g=a("#"+c.gridId+" thead tr:eq("+(e+h)+")").position();a(this).css({top:g.top-f(a(this).find("th").css("border-top-width")),left:g.left})});a("#"+c.gridId+" thead tr:gt("+(e-1)+")").each(function(g){a(this).find("th").each(function(j){var h=a(this);a("#"+c.gridId+" thead tr:eq("+g+") th:eq("+j+")").height(h.height()+((g==e-1)?2:1)*f(h.css("border-top-width"))).width(h.width()+f(h.css("border-left-width")))})});a("#"+c.gridId+"_fixedDiv").data("fixedGridLock","");function f(h){h=a.trim(h).toLowerCase().replace("px","");var g=parseFloat(h);return isNaN(g)?0:g}};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.initGridMethods,"fixedHeader",function(b,c){if(!c.settings.extend.settings.fixedGridHeader){return}a("#"+b).wrap('<div id="'+b+'_fixedDiv"></div>');a("#"+b+"_fixedDiv").data("fixedGridLock","");a("#"+b+"_fixedDiv").css({padding:0,"border-width":0,width:"98%","overflow-y":"auto","margin-bottom":"-1px"});a("#"+b).css({width:"auto"});a("#"+b+"_pt_outTab").css({"border-top-width":"1px"});a.fn.bsgrid.extendOtherMethods.fixedHeader(true,c);a(window).resize(function(){a.fn.bsgrid.extendOtherMethods.fixedHeader(false,c)})});a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.afterRenderGridMethods,"fixedHeader",function(d,c,b){if(b.settings.extend.settings.fixedGridHeader){a.fn.bsgrid.extendOtherMethods.fixedHeader(false,b)}});a.fn.bsgrid.extendInitGrid.bindExtendMethods=function(b,c){var d=a.fn.bsgrid.getGridObj(b);d.getCheckedRowsIndexs=function(){return a.fn.bsgrid.defaults.extend.getCheckedRowsIndexs(c)};d.getCheckedRowsRecords=function(){return a.fn.bsgrid.defaults.extend.getCheckedRowsRecords(c)};d.activeGridEditMode=function(){return a.fn.bsgrid.defaults.extend.activeGridEditMode(c)};d.getChangedRowsIndexs=function(){return a.fn.bsgrid.defaults.extend.getChangedRowsIndexs(c)};d.getChangedRowsOldRecords=function(){return a.fn.bsgrid.defaults.extend.getChangedRowsOldRecords(c)};d.getRowsChangedColumnsValue=function(){return a.fn.bsgrid.defaults.extend.getRowsChangedColumnsValue(c)}};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.initGridMethods,"bindExtendMethods",a.fn.bsgrid.extendInitGrid.bindExtendMethods);a.fn.bsgrid.extendInitGrid.initGridCheck=function(b,c){a.fn.bsgrid.getGridHeaderObject(c).each(function(e){var d=a.trim(a(this).attr(c.settings.colsProperties.checkAttr));if(d=="true"){if(a.trim(a(this).html())==""){a(this).html('<input class="bsgrid_editgrid_check" type="checkbox"/>')}a(this).find("input[type=checkbox]").change(function(){if(a.bsgrid.adaptAttrOrProp(a(this),"checked")){a("#"+b+" tbody tr").each(function(){a.bsgrid.adaptAttrOrProp(a(this).find("td:eq("+e+")>input[type=checkbox]"),"checked",true)})}else{a("#"+b+" tbody tr").each(function(){a.bsgrid.adaptAttrOrProp(a(this).find("td:eq("+e+")>input[type=checkbox]"),"checked",false)})}})}})};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.initGridMethods,"initGridCheck",a.fn.bsgrid.extendInitGrid.initGridCheck);a.fn.bsgrid.extendInitGrid.initSearchConditions=function(b,c){if(a.trim(c.settings.extend.settings.searchConditionsContainerId)==""){return}var e=new StringBuilder();e.append('<select class="bsgrid_conditions_select">');var f={};a.fn.bsgrid.getGridHeaderObject(c).each(function(){var g=a.trim(a(this).attr(c.settings.colsProperties.indexAttr));var h=a.trim(a(this).text());if(g!=""&&h!=""&&a.trim(f[g])==""){f[g]=h}});for(var d in f){e.append('<option value="'+d+'">'+f[d]+"</option>")}e.append("</select>");e.append("&nbsp;");e.append('<input type="text" class="bsgrid_conditions_input" />');a("#"+c.settings.extend.settings.searchConditionsContainerId).html(e.toString());a("#"+c.settings.extend.settings.searchConditionsContainerId+" select.bsgrid_conditions_select").change(function(){a(this).next("input.bsgrid_conditions_input").attr("name",a(this).val())}).trigger("change")};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.initGridMethods,"initSearchConditions",a.fn.bsgrid.extendInitGrid.initSearchConditions);a.fn.bsgrid.extendInitGrid.initColumnMove=function(c,d){if(!d.settings.extend.settings.supportColumnMove||a("#"+d.gridId+" thead tr").length!=1){return}a("#"+d.gridId).css({"table-layout":"fixed"});var e=a.fn.bsgrid.getGridHeaderObject(d);var b=e.length;e.each(function(g){var h=this;a(h).mousedown(function(){f(h,g,b)});a(h).mousemove(function(){var q=a(h).offset().left;var n=0,o=0;if(g!=b-1){n=a(h).next();o=n.offset().left}var p=h;if(g!=b-1&&event.clientX-o>-10){p=n}if((g!=0&&event.clientX-q<10)||(g!=b-1&&event.clientX-o>-10)){a(h).css({cursor:"e-resize"});if(a.trim(a(h).data("ex_mousedown"))!="mousedown"){return}var l=a(p).width();var m=l-event.clientX+a(p).offset().left;var k=a(p).prev().width();var i=k+event.clientX-a(p).offset().left;if(parseInt(m)>19&&parseInt(i)>19){a(p).width(m).prev().width(i)}}else{a(p).css({cursor:"default"});j(h,g,b)}});a(h).mouseup(function(){j(h,g,b)});a(h).mouseout(function(){var i=a(h).offset();if(i.top>event.clientY||i.top+a(h).height()<event.clientY){j(h,g,b)}});function f(m,l,k){if(l!=0){a(m).prev().data("ex_mousedown","mousedown")}a(m).data("ex_mousedown","mousedown");if(l!=k-1){a(m).next().data("ex_mousedown","mousedown")}}function j(m,l,k){if(l!=0){a(m).prev().data("ex_mousedown","")}a(m).data("ex_mousedown","");if(l!=k-1){a(m).next().data("ex_mousedown","")}}})};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.initGridMethods,"initColumnMove",a.fn.bsgrid.extendInitGrid.initColumnMove);a.fn.bsgrid.extendRenderPerColumn.renderCheck=function(e,h,j,d,g,k){if(h<k.curPageRowsNum){var c=a.fn.bsgrid.getGridObj(k.gridId);var b=c.getColumnAttr(j,k.settings.colsProperties.checkAttr);var f=c.getColumnAttr(j,k.settings.colsProperties.indexAttr);var i=c.getColumnValue(h,f);if(b=="true"){return'<input class="bsgrid_editgrid_check" type="checkbox" value="'+i+'"/>'}}return false};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.renderPerColumnMethods,"renderCheck",a.fn.bsgrid.extendRenderPerColumn.renderCheck);a.fn.bsgrid.extendRenderPerColumn.renderForm=function(d,g,j,c,f,k){if(k.settings.extend.settings.supportGridEdit&&g<k.curPageRowsNum){var b=a.fn.bsgrid.getGridObj(k.gridId);var e=b.getColumnAttr(j,k.settings.colsProperties.indexAttr);var i=b.getColumnAttr(j,k.settings.colsProperties.editAttr);var h=b.getColumnValue(g,e);if(i=="checkbox"){return h+'<input class="bsgrid_editgrid_hidden bsgrid_editgrid_checkbox" type="'+i+'" value="'+h+'"/>'}else{if(i=="text"||i=="hidden"||i=="password"||i=="radio"||i=="button"){return h+'<input class="bsgrid_editgrid_hidden bsgrid_editgrid_edit" type="'+i+'" value="'+h+'"/>'}else{if(i=="textarea"){return h+'<textarea class="bsgrid_editgrid_hidden bsgrid_editgrid_edit">'+h+"</textarea>"}}}}return false};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.renderPerColumnMethods,"renderForm",a.fn.bsgrid.extendRenderPerColumn.renderForm);a.fn.bsgrid.extendAfterRenderGrid.addGridEditEvent=function(e,c,b){if(!b.settings.extend.settings.supportGridEdit){return}a("#"+b.gridId+" tbody tr:lt("+b.curPageRowsNum+")").each(function(f){var g=this;a(g).find("td").each(function(i){var l=a.fn.bsgrid.getGridObj(b.gridId);var h=l.getColumnAttr(i,b.settings.colsProperties.indexAttr);var j=l.getColumnAttr(i,b.settings.colsProperties.editAttr);var k=l.getColumnValue(f,h);if(j!=""){a(this).find(".bsgrid_editgrid_checkbox, .bsgrid_editgrid_edit").change(function(){if(a.trim(a(this).val())!=k){a(this).addClass("bsgrid_editgrid_change")}else{a(this).removeClass("bsgrid_editgrid_change")}a(g).data("change",a(g).find(".bsgrid_editgrid_change").length)})}});if(b.settings.extend.settings.supportGridEditTriggerEvent==""){a(this).find(".bsgrid_editgrid_hidden").each(function(){d(this)})}else{if(b.settings.extend.settings.supportGridEditTriggerEvent=="rowClick"){a(this).click(function(){a(this).find(".bsgrid_editgrid_hidden").each(function(){d(this)})})}else{if(b.settings.extend.settings.supportGridEditTriggerEvent=="rowDoubleClick"){a(this).dblclick(function(){a(this).find(".bsgrid_editgrid_hidden").each(function(){d(this)})})}else{if(b.settings.extend.settings.supportGridEditTriggerEvent=="cellClick"){a(this).find(".bsgrid_editgrid_hidden").each(function(){var h=this;a(h).parent("td").click(function(){d(h)})})}else{if(b.settings.extend.settings.supportGridEditTriggerEvent=="cellDoubleClick"){a(this).find(".bsgrid_editgrid_hidden").each(function(){var h=this;a(h).parent("td").dblclick(function(){d(h)})})}}}}}});function d(f){var g=a(f).removeClass("bsgrid_editgrid_hidden").clone(true);a(f).parent("td").html(g)}};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.afterRenderGridMethods,"addGridEditEvent",a.fn.bsgrid.extendAfterRenderGrid.addGridEditEvent);a.fn.bsgrid.extendAfterRenderGrid.aggregation=function(f,c,b){var d=b.settings.colsProperties.aggAttr;if(a("#"+b.gridId+" tfoot td["+d+"!='']").length==0){return}var e=a.fn.bsgrid.getGridObj(b.gridId);a("#"+b.gridId+" tfoot tr td["+d+"!='']").each(function(){var g=a.trim(a(this).attr(d));if(g.length!=0){var h=g.split(",");var l=h[0].toLocaleLowerCase();var j=h.length>1?h[1]:"";var k=null;if(l=="count"){k=b.curPageRowsNum}else{if(l=="countnotnone"||l=="sum"||l=="avg"||l=="max"||l=="min"||l=="concat"){if(l=="countnotnone"){k=0}var i=new StringBuilder();a("#"+b.gridId+" tbody tr:lt("+b.curPageRowsNum+")").each(function(m){var n=e.getColumnValue(m,j);if(n==""){}else{if(l=="countnotnone"){k=(k==null?0:k)+1}else{if(l=="sum"||l=="avg"){if(!isNaN(n)){k=(k==null?0:k)+parseFloat(n)}}else{if(l=="max"||l=="min"){if(!isNaN(n)&&(k==null||(l=="max"&&parseFloat(n)>k)||(l=="min"&&parseFloat(n)<k))){k=parseFloat(n)}}else{if(l=="concat"){i.append(n)}}}}}});if(l=="avg"&&k!=null){k=k/b.curPageRowsNum}else{if(l=="concat"){k=i.toString()}}}}k=k==null?"":k;a(this).html(k)}})};a.bsgrid.forcePushPropertyInObject(a.fn.bsgrid.defaults.extend.afterRenderGridMethods,"aggregation",a.fn.bsgrid.extendAfterRenderGrid.aggregation);a.fn.bsgrid.defaults.extend.getCheckedRowsIndexs=function(b){var c=[];a("#"+b.gridId+" tbody tr").each(function(d){if(a(this).find("td>input:checked").length==1){c[c.length]=d}});return c};a.fn.bsgrid.defaults.extend.getCheckedRowsRecords=function(c){var b=[];a.each(a.fn.bsgrid.defaults.extend.getCheckedRowsIndexs(c),function(d,e){b[b.length]=a.fn.bsgrid.getRecord(e,c)});return b};a.fn.bsgrid.defaults.extend.activeGridEditMode=function(b){if(!b.settings.extend.settings.supportGridEdit){return}a("#"+b.gridId+" tbody tr:lt("+b.curPageRowsNum+") td .bsgrid_editgrid_hidden").each(function(){var c=a(this).removeClass("bsgrid_editgrid_hidden").clone(true);a(this).parent("td").html(c)})};a.fn.bsgrid.defaults.extend.getChangedRowsIndexs=function(b){var c=[];a("#"+b.gridId+" tbody tr").each(function(d){var e=a.trim(a(this).data("change"));if(!isNaN(e)&&parseInt(e)>0){c[c.length]=d}});return c};a.fn.bsgrid.defaults.extend.getChangedRowsOldRecords=function(c){var b=[];a.each(a.fn.bsgrid.defaults.extend.getChangedRowsIndexs(c),function(d,e){b[b.length]=a.fn.bsgrid.getRecord(e,c)});return b};a.fn.bsgrid.defaults.extend.getRowsChangedColumnsValue=function(c){var b={};var d=a.fn.bsgrid.getGridObj(c.gridId);a.each(a.fn.bsgrid.defaults.extend.getChangedRowsIndexs(c),function(e,f){b["row_"+f]={};a("#"+c.gridId+" tbody tr:eq("+f+") td").each(function(h){if(a(this).find(".bsgrid_editgrid_change").length>0){var g=d.getColumnAttr(h,c.settings.colsProperties.indexAttr);b["row_"+f][g]=a(this).find(".bsgrid_editgrid_change").val()}})});return b}})(jQuery);